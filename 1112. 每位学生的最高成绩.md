## [1112. 每位学生的最高成绩](https://leetcode-cn.com/problems/highest-grade-for-each-student/)

表：Enrollments

+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| student_id    | int     |
| course_id     | int     |
| grade         | int     |
+---------------+---------+
(student_id, course_id) 是该表的主键。

 

编写一个 SQL 查询，查询每位学生获得的最高成绩和它所对应的科目，若科目成绩并列，取 course_id 最小的一门。查询结果需按 student_id 增序进行排序。

查询结果格式如下所示：

Enrollments 表：
+------------+-------------------+
| student_id | course_id | grade |
+------------+-----------+-------+
| 2          | 2         | 95    |
| 2          | 3         | 95    |
| 1          | 1         | 90    |
| 1          | 2         | 99    |
| 3          | 1         | 80    |
| 3          | 2         | 75    |
| 3          | 3         | 82    |
+------------+-----------+-------+

Result 表：
+------------+-------------------+
| student_id | course_id | grade |
+------------+-----------+-------+
| 1          | 2         | 99    |
| 2          | 2         | 95    |
| 3          | 3         | 82    |
+------------+-----------+-------+

sql脚本：

```sql
Create table If Not Exists Enrollments (student_id int, course_id int, grade int);
Truncate table Enrollments;
insert into Enrollments (student_id, course_id, grade) values (2, 2, 95);
insert into Enrollments (student_id, course_id, grade) values (2, 3, 95);
insert into Enrollments (student_id, course_id, grade) values (1, 1, 90);
insert into Enrollments (student_id, course_id, grade) values (1, 2, 99);
insert into Enrollments (student_id, course_id, grade) values (3, 1, 80);
insert into Enrollments (student_id, course_id, grade) values (3, 2, 75);
insert into Enrollments (student_id, course_id, grade) values (3, 3, 82);
```

### 解答

解法：

```sql
-- 1. 查询出每位学生具有最小科目ID的最高成绩
SELECT DISTINCT e1.student_id, e1.course_id, e1.grade FROM Enrollments e1 LEFT JOIN Enrollments e2 ON (e1.student_id = e2.student_id) WHERE e1.grade >= e2.grade;

SELECT * FROM (SELECT student_id, course_id, grade FROM Enrollments ORDER BY student_id, grade DESC, course_id) t GROUP BY t.student_id HAVING MAX(t.grade);


SELECT t1.student_id, t1.course_id, MAX(t1.grade) FROM (SELECT t.student_id, t.course_id, t.grade FROM (SELECT student_id, course_id, grade FROM Enrollments e ORDER BY student_id, grade DESC, course_id) t GROUP BY t.student_id) t1;

-- SELECT student_id, course_id, grade FROM Enrollments e ORDER BY student_id, grade DESC, course_id;

SELECT t.student_id, t.course_id, MAX(t.grade) FROM (SELECT student_id, course_id, grade FROM Enrollments e ORDER BY student_id, grade DESC, course_id) t GROUP BY t.student_id;
```

